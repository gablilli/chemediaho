<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#f03333" />
    <meta name="description" content="Visualizza la media dei voti di ClasseViva" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="chemediaho?" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png" />
    <title>Autenticazione - che media ho?</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --text: #f1e4e4;
        --background: #130909;
        --primary: #f03333;
        --secondary: #7f2929;
        --accent: #c83737;
      }

      :root[data-theme="light"] {
        --text: #1a0a0a;
        --background: #fef8f8;
        --primary: #f03333;
        --secondary: #f5cccc;
        --accent: #c83737;
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: var(--background);
        color: var(--text);
        font-family: Arial, Helvetica, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .login-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 400px;
        padding: 24px;
        min-height: 100vh;
      }

      .icon-wrapper {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .icon-box {
        position: relative;
        overflow: hidden;
        padding: 36px;
        border-radius: 55px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        margin-bottom: 24px;
      }

      .icon-box::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: var(--secondary);
        opacity: 0.45;
        z-index: -1;
      }

      .icon {
        width: 100px;
        height: 100px;
        fill: var(--accent);
      }

      .title-section {
        text-align: center;
        margin-bottom: 16px;
      }

      .title {
        font-size: 36px;
        font-weight: bold;
        color: var(--accent);
        margin-bottom: 8px;
      }

      .subtitle {
        color: var(--secondary);
        font-size: 14px;
      }

      .form-container {
        flex: 1;
        display: flex;
        width: 100%;
        align-items: center;
        flex-direction: column;
        justify-content: flex-end;
        padding-bottom: 32px;
      }

      form {
        width: 100%;
      }

      .form-group {
        width: 100%;
        margin-bottom: 16px;
      }

      .form-label {
        display: block;
        padding-bottom: 4px;
        font-weight: 600;
        font-size: 14px;
        color: var(--accent);
      }

      .input-wrapper {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
      }

      .input-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: var(--secondary);
        opacity: 0.25;
        z-index: -1;
      }

      .form-input {
        background: transparent;
        border: none;
        outline: 2px solid transparent;
        border-radius: 12px;
        padding: 12px;
        width: 100%;
        font-size: 15px;
        color: var(--text);
        transition: outline-color 0.2s ease;
      }

      .form-input::placeholder {
        color: var(--accent);
        opacity: 0.35;
      }

      .form-input:focus {
        outline-color: var(--primary);
      }

      .btn-submit {
        width: 100%;
        background: var(--primary);
        color: var(--text);
        border: none;
        border-radius: 12px;
        padding: 12px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: opacity 0.2s ease;
        margin-top: 28px;
      }

      .btn-submit:hover {
        opacity: 0.8;
      }

      .btn-submit:active {
        opacity: 0.6;
      }

      .footer-text {
        text-align: center;
        color: var(--secondary);
        font-size: 14px;
        padding: 20px 0 32px;
      }

      .footer-text a {
        color: var(--text);
        text-decoration: underline;
      }

      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--secondary);
        border: 2px solid var(--accent);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
        background: var(--accent);
      }

      .theme-toggle svg {
        width: 24px;
        height: 24px;
        fill: var(--text);
      }

      .error-message {
        color: var(--accent);
        text-align: left;
        font-size: 14px;
        margin-top: 4px;
        min-height: 20px;
      }

      @media (max-width: 480px) {
        .login-container {
          padding: 16px;
        }

        .title {
          font-size: 32px;
        }

        .icon {
          width: 80px;
          height: 80px;
        }

        .icon-box {
          padding: 30px;
        }
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" x2="12" y1="1" y2="3"/>
        <line x1="12" x2="12" y1="21" y2="23"/>
        <line x1="4.22" x2="5.64" y1="4.22" y2="5.64"/>
        <line x1="18.36" x2="19.78" y1="18.36" y2="19.78"/>
        <line x1="1" x2="3" y1="12" y2="12"/>
        <line x1="21" x2="23" y1="12" y2="12"/>
        <line x1="4.22" x2="5.64" y1="19.78" y2="18.36"/>
        <line x1="18.36" x2="19.78" y1="5.64" y2="4.22"/>
      </svg>
    </button>
    <div class="login-container">
      <div class="icon-wrapper">
        <div class="icon-box">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" x2="12.01" y1="17" y2="17"/>
          </svg>
        </div>
        <div class="title-section">
          <p class="title">Autenticati</p>
          <p class="subtitle">Inserisci le tue credenziali classeviva per fare l'accesso</p>
        </div>
      </div>

      <div class="form-container">
        <form action="/login" method="post" id="loginForm">
          <div class="form-group">
            <label for="user_id" class="form-label">User ID</label>
            <div class="input-wrapper">
              <input 
                type="text" 
                class="form-input" 
                id="user_id" 
                name="user_id" 
                placeholder="G123456789P"
                required
                autocomplete="username"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="user_pass" class="form-label">Password</label>
            <div class="input-wrapper">
              <input 
                type="password" 
                class="form-input" 
                id="user_pass" 
                name="user_pass" 
                placeholder="••••••••••••••"
                required
                autocomplete="current-password"
              />
            </div>
          </div>

          <div class="error-message" id="errorMessage"></div>

          <button type="submit" class="btn-submit" id="submitBtn">
            Accedi
          </button>

          <p class="footer-text">
            Non hai queste credenziali? 
            <a href="https://web.spaggiari.eu/home/app/default/login.php" target="_blank" rel="noopener noreferrer">recuperale</a>
          </p>
        </form>
      </div>
    </div>

    <script>
      // Theme management
      const themeToggle = document.getElementById('themeToggle');
      const root = document.documentElement;
      
      // Load saved theme or default to dark
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'light') {
        root.setAttribute('data-theme', 'light');
      }
      
      // Toggle theme
      themeToggle.addEventListener('click', () => {
        const currentTheme = root.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        if (newTheme === 'light') {
          root.setAttribute('data-theme', 'light');
        } else {
          root.removeAttribute('data-theme');
        }
        
        localStorage.setItem('theme', newTheme);
      });

      // Simple form validation and error display
      const form = document.getElementById('loginForm');
      const errorMessage = document.getElementById('errorMessage');
      const submitBtn = document.getElementById('submitBtn');

      form.addEventListener('submit', function(e) {
        errorMessage.textContent = '';
        submitBtn.disabled = true;
        submitBtn.textContent = 'Accesso...';
      });

      // Check for error in URL (if redirected back with error)
      const urlParams = new URLSearchParams(window.location.search);
      const error = urlParams.get('error');
      if (error) {
        errorMessage.textContent = decodeURIComponent(error);
      }

      // Register Service Worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('Service Worker registered successfully:', registration.scope);
            })
            .catch(error => {
              console.log('Service Worker registration failed:', error);
            });
        });
      }
    </script>
  </body>
</html>
