<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Le Tue Medie - ClasseViva</title>
    <style>
      :root {
        --bg-light: #F8FAFC;
        --bg-secondary: #E2E8F0;
        --text-dark: #0F172A;
        --accent: #3B82F6;
        
        --bg-dark: #0F172A;
        --bg-dark-secondary: #1E293B;
        --text-light: #CBD5E1;
      }

      body {
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      body.light-mode {
        background-color: var(--bg-light);
        color: var(--text-dark);
      }

      body.dark-mode {
        background-color: var(--bg-dark);
        color: var(--text-light);
      }

      .blur-card {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .light-mode .blur-card {
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(226, 232, 240, 0.8);
      }

      .dark-mode .blur-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(51, 65, 85, 0.8);
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .fade-in {
        animation: fadeIn 0.4s ease-out;
      }

      .grade-badge {
        transition: all 0.2s ease;
      }

      .grade-badge:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'bg-light': '#F8FAFC',
              'bg-secondary': '#E2E8F0',
              'text-dark': '#0F172A',
              'accent': '#3B82F6',
              'bg-dark': '#0F172A',
              'bg-dark-secondary': '#1E293B',
              'text-light': '#CBD5E1',
            }
          }
        }
      }
    </script>
  <body class="light-mode">
    <!-- Dark Mode Toggle -->
    <button 
      id="darkModeToggle" 
      class="fixed top-4 right-4 z-50 w-12 h-12 rounded-full bg-white/20 dark:bg-slate-800/20 backdrop-blur-md border border-slate-200/50 dark:border-slate-700/50 flex items-center justify-center hover:scale-110 transition-all duration-200 shadow-lg"
      aria-label="Toggle Dark Mode"
    >
      <svg id="sunIcon" class="w-6 h-6 text-slate-700" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
      </svg>
      <svg id="moonIcon" class="w-6 h-6 text-slate-200 hidden" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
      </svg>
    </button>

    <!-- Main Container -->
    <div class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
      <!-- Header Section -->
      <div class="max-w-7xl mx-auto mb-8 fade-in">
        <div class="text-center mb-6">
          <h1 class="text-4xl sm:text-5xl font-bold mb-4 light-mode:text-slate-900 dark-mode:text-slate-100">
            Le Tue Medie
          </h1>
          <p class="text-slate-600 dark-mode:text-slate-400 text-lg">
            Anno Scolastico 2024/2025
          </p>
        </div>

        <!-- Overall Average Card -->
        <div class="blur-card rounded-3xl p-8 max-w-md mx-auto shadow-xl">
          <div class="text-center">
            <p class="text-sm font-semibold uppercase tracking-wide mb-4 text-slate-600 dark-mode:text-slate-400">
              Media Generale
            </p>
            <div class="relative inline-flex items-center justify-center">
              <div class="w-32 h-32 rounded-full bg-gradient-to-br from-accent/20 to-accent/5 flex items-center justify-center shadow-inner">
                <span class="text-5xl font-bold bg-gradient-to-br from-accent to-blue-600 bg-clip-text text-transparent">
                  {{ grades_avr["all_avr"] | round(2) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Periods Section -->
      <div class="max-w-7xl mx-auto space-y-6">
        {% for period, subjects in grades_avr.items() if period != 'all_avr' %}
        <div class="blur-card rounded-3xl p-6 sm:p-8 shadow-xl fade-in">
          <!-- Period Header -->
          <div class="flex flex-col sm:flex-row items-center justify-between mb-8 gap-4">
            <h2 class="text-2xl sm:text-3xl font-bold light-mode:text-slate-900 dark-mode:text-slate-100">
              Periodo {{ period }}
            </h2>
            <div class="flex items-center gap-3">
              <span class="text-sm font-medium text-slate-600 dark-mode:text-slate-400">Media:</span>
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-accent/20 to-accent/5 flex items-center justify-center shadow-inner">
                <span class="text-2xl font-bold text-accent">
                  {{ grades_avr[period]['period_avr'] | round(1) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Subjects Grid -->
          <div class="grid gap-4 sm:gap-6">
            {% for subject, data in subjects.items() %}
            {% if subject != 'period_avr' %}
            <div class="group">
              <div class="blur-card rounded-2xl p-5 hover:shadow-lg transition-all duration-200 border-l-4 
                {% if data.avr >= 8 %}border-green-500{% elif data.avr >= 7 %}border-blue-500{% elif data.avr >= 6 %}border-yellow-500{% else %}border-red-500{% endif %}">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                  <!-- Subject Info -->
                  <div class="flex-1 min-w-0">
                    <h3 class="text-xl font-bold mb-3 light-mode:text-slate-900 dark-mode:text-slate-100 truncate">
                      {{ subject }}
                    </h3>
                    <div class="flex flex-wrap gap-2">
                      {% for grade in data.grades %}
                      <button
                        onclick="showGradeModal('{{ grade.decimalValue }}', '{{ grade.evtDate }}', '{{ grade.componentDesc }}', '{{ grade.teacherName }}', '{{ grade.notesForFamily }}')"
                        class="grade-badge inline-flex items-center justify-center px-4 py-2 rounded-xl text-white font-semibold text-sm shadow-md
                        {% if grade.decimalValue >= 8 %}bg-green-500 hover:bg-green-600{% elif grade.decimalValue >= 7 %}bg-blue-500 hover:bg-blue-600{% elif grade.decimalValue >= 6 %}bg-yellow-500 hover:bg-yellow-600{% else %}bg-red-500 hover:bg-red-600{% endif %}"
                      >
                        {{ grade.decimalValue }}
                      </button>
                      {% endfor %}
                    </div>
                  </div>
                  
                  <!-- Subject Average -->
                  <div class="flex-shrink-0">
                    <div class="text-center">
                      <div class="w-20 h-20 rounded-2xl bg-gradient-to-br 
                        {% if data.avr >= 8 %}from-green-500/20 to-green-500/5{% elif data.avr >= 7 %}from-blue-500/20 to-blue-500/5{% elif data.avr >= 6 %}from-yellow-500/20 to-yellow-500/5{% else %}from-red-500/20 to-red-500/5{% endif %}
                        flex items-center justify-center shadow-inner">
                        <span class="text-2xl font-bold 
                          {% if data.avr >= 8 %}text-green-600{% elif data.avr >= 7 %}text-blue-600{% elif data.avr >= 6 %}text-yellow-600{% else %}text-red-600{% endif %}">
                          {{ data.avr | round(1) }}
                        </span>
                      </div>
                      <p class="text-xs text-slate-600 dark-mode:text-slate-400 mt-2 font-medium">Media</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Grade Details Modal -->
    <div id="gradeModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
      <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 transition-opacity bg-slate-900/75 backdrop-blur-sm" onclick="closeModal()"></div>
        
        <!-- Modal panel -->
        <div class="inline-block align-bottom blur-card rounded-3xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div class="px-6 py-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-bold light-mode:text-slate-900 dark-mode:text-slate-100">
                ðŸ“Š Dettagli Voto
              </h3>
              <button 
                onclick="closeModal()" 
                class="w-10 h-10 rounded-full hover:bg-slate-200/50 dark-mode:hover:bg-slate-700/50 flex items-center justify-center transition-colors"
              >
                <svg class="w-6 h-6 text-slate-600 dark-mode:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
            
            <div class="space-y-4">
              <div class="flex items-center gap-3">
                <span class="text-slate-600 dark-mode:text-slate-400 font-medium min-w-[100px]">Voto:</span>
                <span id="modalGrade" class="text-2xl font-bold text-accent"></span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-slate-600 dark-mode:text-slate-400 font-medium min-w-[100px]">Data:</span>
                <span id="modalDate" class="font-semibold light-mode:text-slate-900 dark-mode:text-slate-100"></span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-slate-600 dark-mode:text-slate-400 font-medium min-w-[100px]">Tipo:</span>
                <span id="modalComponent" class="font-semibold light-mode:text-slate-900 dark-mode:text-slate-100"></span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-slate-600 dark-mode:text-slate-400 font-medium min-w-[100px]">Docente:</span>
                <span id="modalTeacher" class="font-semibold light-mode:text-slate-900 dark-mode:text-slate-100"></span>
              </div>
              <div class="flex flex-col gap-2">
                <span class="text-slate-600 dark-mode:text-slate-400 font-medium">Note:</span>
                <p id="modalNotes" class="text-sm light-mode:text-slate-700 dark-mode:text-slate-300 italic"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Dark mode toggle
      const darkModeToggle = document.getElementById('darkModeToggle');
      const sunIcon = document.getElementById('sunIcon');
      const moonIcon = document.getElementById('moonIcon');
      const body = document.body;

      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      }

      darkModeToggle.addEventListener('click', () => {
        if (body.classList.contains('light-mode')) {
          body.classList.remove('light-mode');
          body.classList.add('dark-mode');
          sunIcon.classList.add('hidden');
          moonIcon.classList.remove('hidden');
          localStorage.setItem('theme', 'dark');
        } else {
          body.classList.remove('dark-mode');
          body.classList.add('light-mode');
          sunIcon.classList.remove('hidden');
          moonIcon.classList.add('hidden');
          localStorage.setItem('theme', 'light');
        }
      });

      // Modal functions
      function showGradeModal(grade, date, component, teacher, notes) {
        document.getElementById('modalGrade').textContent = grade;
        document.getElementById('modalDate').textContent = date;
        document.getElementById('modalComponent').textContent = component || 'N/A';
        document.getElementById('modalTeacher').textContent = teacher || 'N/A';
        document.getElementById('modalNotes').textContent = notes || 'Nessuna nota';
        document.getElementById('gradeModal').classList.remove('hidden');
      }

      function closeModal() {
        document.getElementById('gradeModal').classList.add('hidden');
      }

      // Close modal on ESC key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
        }
      });
    </script>
  </body>
</html>
